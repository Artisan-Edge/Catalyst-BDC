# v0.1.0

## Release Date

2026-02-10

## Overview

First release of Catalyst-BDC, a TypeScript library for programmatic SAP Datasphere object management. The original 173-line CLI script (`create-object.ts`) has been replaced by a layered library with a typed client API, structured error handling, and automated dependency resolution. Consumers can now create, validate, and delete Datasphere objects (views, local tables, replication flows) from code instead of running a script manually.

## Breaking Changes

This is the initial packaged release. If you were using the prior `create-object.ts` script directly, note the following migration steps:

- **Script removed** -- The `create-object.ts` CLI script no longer exists. Use the `BdcClient` API instead:
  ```ts
  import { createClient } from 'catalyst-bdc';

  const [client, error] = createClient({ host: '...', space: '...' });
  if (error) { /* handle */ }

  await client.login();
  await client.createView(csn, 'MyView');
  ```
- **No built-in env loading** -- The library no longer imports `dotenv/config`. Consumers are responsible for loading environment variables before calling `createClient()`.
- **Package renamed** -- The package name changed from `datasphere-cli` to `catalyst-bdc`.

## What's New

### Programmatic Client API

`createClient()` returns a typed `BdcClient` with methods for every supported Datasphere operation. Configuration is validated at construction time via Zod, so invalid host URLs or missing space IDs fail immediately rather than at CLI invocation.

### OAuth Login with Session Caching

`client.login()` handles the full OAuth browser flow and initializes the CLI discovery cache in a single call. If an active session already exists, the browser step is skipped entirely -- this prevents the CLI from hanging on an interactive overwrite prompt during non-interactive runs.

### Replication Flow Dependency Resolution

`client.createReplicationFlow()` automatically resolves and creates target local tables before creating the flow itself. The Datasphere CLI (unlike the UI) does not auto-create these targets, so the library inspects the CSN's `replicationflows[name].targets` keys and creates each local table first.

### Delete Operations

`client.deleteObject()` supports views, local tables, and replication flows. It uses `--technical-name` and `--force` to avoid interactive confirmation prompts.

### Go-Style Result Tuples

All fallible operations return `[T, null] | [null, Error]` tuples instead of throwing exceptions. This forces callers to handle errors explicitly at each call site:

```ts
const [result, error] = await client.createView(csn, 'MyView');
if (error) {
    console.error('Failed:', error.message);
    return;
}
// result is guaranteed non-null here
```

### Typed CSN Interfaces

`CsnFile`, `CsnEntity`, `CsnElement`, and `CsnReplicationFlow` interfaces give structure to the previously untyped JSON payloads that the CLI expects. The `extractObject` utility pulls a single named object from a multi-definition CSN file, since the Datasphere API only accepts one object per request.

### Extensible Object Type Registry

`DSP_OBJECT_TYPES` maps each supported object type to its CLI subcommand, CSN key, and optional `preDeps` resolver. Adding a new object type means adding one entry to this registry -- the rest of the pipeline picks it up automatically.

## Technical Details

### Architecture

The codebase follows a strict layered import hierarchy with no cycles:

```
src/
├── types/           # Result, BdcConfig (Zod), CSN types, object type registry
├── core/
│   ├── cli/         # CliExecutor (execSync wrapper), temp file lifecycle
│   ├── csn/         # extractObject, validateCsnFile, resolveDependencies
│   ├── operations/  # login, createView, createLocalTable, createReplicationFlow, deleteObject
│   └── utils/       # debug logging
├── client/          # BdcClient interface + createClient factory
└── index.ts         # Public barrel exports
```

Import direction: `types <- core/utils <- core/cli <- core/csn <- core/operations <- client`.

### Key Design Decisions

- **Shell out via `execSync`** -- The `@sap/datasphere-cli` programmatic API (`getCommands`) reinitializes internal state and loses auth context. Shelling out to `npx datasphere` is the only reliable approach.
- **Temp file lifecycle** -- File paths with spaces break the CLI's argument parser, so all CSN payloads are written to `os.tmpdir()` and cleaned up in `finally` blocks.
- **`spawn` for login, `execSync` for everything else** -- The OAuth flow requires browser interaction; `execSync` would block. All other CLI commands are synchronous and wrapped in result tuples.
- **One function per file in operations/** -- Each operation is independently testable and importable.

### Build & Test

- **Build**: `tsup` produces ESM (`.js`), CJS (`.cjs`), and type declarations (`.d.ts`)
- **Test**: `bun test` -- integration tests hit the real Datasphere CLI (requires active OAuth session via `npm run login`)
- **Typecheck**: `tsc --noEmit`
- **No mocking** -- All tests run against real functions and real services

### Dependencies

| Dependency | Purpose |
|---|---|
| `@sap/datasphere-cli` ^2026.2.0 | Underlying CLI (invoked via `npx datasphere`) |
| `zod` ^3.24.0 | Runtime config validation |
| `tsup` ^8.4.0 (dev) | Dual-format build |
| `bun-types` ^1.2.0 (dev) | Test runner type support |
| `dotenv` ^16.4.0 (dev) | Test env loading only |

## Commits Included

| Hash | Message |
|---|---|
| `ec46021` | [VERSION] v0.1.0 |
| `19ae0f8` | [UPDATE] First successful test suite! |
| `ecc0d2d` | [UPDATE] First generated CSN has been uploaded |
| `98bb512` | [UPDATE] Trying to get the login stuff to work |
| `ec0dc2e` | [UPDATE] First pass |
| `b23d9f9` | [UPDATE] Adding some settings and a test asset |
| `0ecf00e` | [UPDATE] Gitignore and docs |
| `36e8dd7` | [UPDATE] Gitignore and docs |
| `4740b05` | [INIT] |
